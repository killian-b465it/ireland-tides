<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Real-time tide data for fishing around Ireland's coast. View current water levels, high/low tide times, and fishing conditions for all Irish coastal locations.">
  <title>Ireland Tides - Real-Time Fishing Tide Data</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="">

  <!-- App Styles -->
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <!-- Google AdSense Verification -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4749246157404876"
    crossorigin="anonymous"></script>
</head>

<body>
  <!-- Loading Screen -->
  <div id="loading-screen">
    <div class="loading-content">
      <h1 class="welcome-text">Welcome</h1>
      <h2 class="sub-welcome-text">Irish Fishing Hub</h2>
      <div class="loading-logo-wrapper">
        <div class="water-wave">ğŸŒŠ</div>
      </div>
    </div>
  </div>

  <!-- Beta Banner -->
  <div class="beta-banner" id="beta-banner">
    <span class="beta-icon">ğŸš§</span>
    <span class="beta-text"><strong>BETA</strong> â€” This app is in beta testing. Expect bugs! Premium features are
      <strong>FREE during beta</strong> and will be priced later.</span>
    <button class="beta-close" onclick="closeBetaBanner()" aria-label="Dismiss">&times;</button>
  </div>

  <!-- Navigation bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-links">
        <a href="#" class="nav-link active" id="nav-home" onclick="showPage('home')">Dashboard</a>
        <a href="#" class="nav-link" id="nav-community" onclick="showPage('community')">Community</a>
        <a href="#" class="nav-link" id="nav-directory" onclick="showPage('directory')">Shop Directory</a>
        <a href="#" class="nav-link admin-only" id="nav-admin" onclick="showPage('admin')" style="display: none;">ğŸ›¡ï¸
          Admin</a>
      </div>

      <div class="nav-brand">
        <img src="assets/logo.png" alt="Logo" class="nav-logo-img"
          style="height: 32px; width: 32px; margin-right: 8px;">
        <span class="nav-title">Irish Fishing Hub</span>
      </div>

      <div class="nav-right">
        <div class="nav-auth">
          <button class="btn btn-sm btn-outline" id="login-btn" onclick="openAuthModal()">Login</button>
          <div id="user-display" style="display: none;" onclick="openProfileModal()">
            <span id="user-name-label">User</span>
            <div class="user-avatar-wrapper">
              <div class="user-avatar">ğŸ‘¤</div>
              <span class="notification-badge" id="notification-badge" style="display: none;">0</span>
            </div>
          </div>
        </div>
        <div class="nav-live">
          <div class="live-indicator">
            <span class="live-dot"></span>
            <span>LIVE</span>
          </div>
          <span id="current-time"></span>
        </div>
        <!-- Mobile Menu Button -->
        <button class="hamburger-btn" id="hamburger-btn" onclick="toggleMobileMenu()">
          <span style="display:block;width:18px;height:3px;background:#fff;border-radius:2px;"></span>
          <span style="display:block;width:18px;height:3px;background:#fff;border-radius:2px;"></span>
          <span style="display:block;width:18px;height:3px;background:#fff;border-radius:2px;"></span>
        </button>
      </div>
    </div>
    <!-- Mobile Dropdown Menu -->
    <div class="mobile-menu" id="mobile-menu">
      <a href="#" class="mobile-menu-link" onclick="showPage('home'); closeMobileMenu()">Dashboard</a>
      <a href="#" class="mobile-menu-link" onclick="showPage('community'); closeMobileMenu()">Community</a>
      <a href="#" class="mobile-menu-link" onclick="showPage('directory'); closeMobileMenu()">Shop Directory</a>
      <a href="#" class="mobile-menu-link admin-only" id="mobile-nav-admin"
        onclick="showPage('admin'); closeMobileMenu()" style="display: none;">ğŸ›¡ï¸ Admin</a>
      <a href="#" class="mobile-menu-link" onclick="openTermsModal(); closeMobileMenu()">âš–ï¸ Terms & Conditions</a>
    </div>
  </nav>


  <!-- Home Page (Dashboard) -->
  <main class="page active" id="page-home">
    <!-- Fishing Mode Toggle (Moved inside page container) -->
    <div class="fishing-mode-toggle-wrapper">
      <div class="fishing-mode-toggle" id="fishing-mode-toggle-container">
        <span class="mode-label active" id="mode-label-sea">ğŸŒŠ Sea</span>
        <label class="toggle-switch">
          <input type="checkbox" id="fishing-mode-toggle" onchange="toggleFishingMode()">
          <span class="toggle-slider"></span>
        </label>
        <span class="mode-label" id="mode-label-freshwater">ğŸï¸ Freshwater</span>

        <!-- Filter Button (moved here for sleeker UI) -->
        <button class="filter-toggle-btn-inline" id="filter-toggle-btn" onclick="toggleFilterPanel()"
          title="Show/Hide Map Layers">
          <span class="filter-toggle-icon">ğŸ—ºï¸</span>
          <span class="filter-toggle-text">Map Layers</span>
        </button>
      </div>
    </div>

    <div class="app-container">
      <!-- Sidebar -->
      <aside class="sidebar">
        <!-- Location Info -->
        <div class="card fade-in" id="location-card">
          <div class="card-header">
            <span class="card-title">ğŸ“ Selected Location</span>
          </div>
          <div id="location-info">
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ—ºï¸</div>
              <p>Select a tide station on the map</p>
            </div>
          </div>
        </div>

        <!-- Current Tide -->
        <div class="card fade-in" id="tide-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">ğŸŒŠ Current Tide</span>
          </div>
          <div class="tide-current" id="tide-current">
            <div class="loading">
              <div class="loading-spinner"></div>
              <span>Loading tide data...</span>
            </div>
          </div>
        </div>

        <!-- Weather Conditions -->
        <div class="card fade-in" id="weather-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">ğŸŒ¦ï¸ Local Weather</span>
          </div>
          <div class="weather-display" id="weather-display">
            <div class="loading">
              <div class="loading-spinner"></div>
              <span>Fetching weather...</span>
            </div>
          </div>
        </div>

        <!-- Today's Tides -->
        <div class="card fade-in" id="tide-times-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">â° Today's Tides</span>
          </div>
          <div class="tide-times" id="tide-times">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Fishing Conditions -->
        <div class="card fade-in" id="fishing-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">ğŸ£ Fishing Conditions</span>
          </div>
          <div class="fishing-score" id="fishing-score">
            <!-- Populated by JS -->
          </div>
          <div class="moon-phase" id="moon-phase" style="margin-top: var(--space-md);">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Nearby Shops -->
        <div class="card fade-in" id="shops-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">ğŸ“ Nearby Fishing Shops</span>
          </div>
          <div class="shop-list" id="shop-list">
            <div class="loading">
              <div class="loading-spinner"></div>
              <span>Searching for shops...</span>
            </div>
          </div>
        </div>

        <!-- Tide Chart -->
        <div class="card fade-in" id="chart-card" style="display: none;">
          <div class="card-header">
            <span class="card-title">ğŸ“ˆ Tide Chart (24h)</span>
          </div>
          <div class="chart-container">
            <canvas id="tide-chart"></canvas>
          </div>
        </div>

        <!-- Station List -->
        <div class="card">
          <div class="card-header">
            <span class="card-title">ğŸ“‹ All Stations</span>
          </div>
          <div class="station-list" id="station-list">
            <div class="loading">
              <div class="loading-spinner"></div>
              <span>Loading stations...</span>
            </div>
          </div>
        </div>
        <div class="sidebar-footer">
          <a href="#" onclick="openTermsModal()">Terms & Conditions</a>
          <span>&copy; 2026 Irish Fishing Hub</span>
        </div>
      </aside>

      <!-- Map -->
      <section class="map-container">

        <!-- Collapsible Filter Panel -->
        <div class="filter-sidebar" id="filter-sidebar">
          <div class="filter-sidebar-header">
            <h3>Map Filters</h3>
            <button class="filter-close-btn" onclick="applyAndCloseFilters()">&times;</button>
          </div>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" id="filter-stations">
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸŒŠ</span> Tidal Stations
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-shops">
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸª</span> Tackle Shops
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-piers">
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸ£</span> Fishing Piers
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-ramps">
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸš¤</span> Boat Ramps
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-harbours">
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸ›¥ï¸</span> Harbours
            </label>
          </div>
          <button class="filter-apply-btn" onclick="applyFilters()">âœ“ Apply Filters</button>
        </div>

        <!-- Filter Overlay -->
        <div class="filter-overlay" id="filter-overlay" onclick="closeFilterPanel()"></div>

        <!-- Freshwater Filter Sidebar (hidden in sea mode) -->
        <div class="filter-sidebar freshwater-filter-sidebar" id="freshwater-filter-sidebar" style="display: none;">
          <div class="filter-sidebar-header">
            <h3>ğŸï¸ Freshwater Filters</h3>
            <button class="filter-close-btn" onclick="applyFreshwaterFilters()">&times;</button>
          </div>
          <div class="filter-options">
            <label class="filter-option">
              <input type="checkbox" id="filter-fw-spots" checked>
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸŸ</span> Fishing Spots
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-fw-parks" checked>
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸï¸</span> Fishing Parks
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-fw-ramps" checked>
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸš¤</span> Boat Ramps
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-fw-piers" checked>
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸ£</span> Piers & Platforms
            </label>
            <label class="filter-option">
              <input type="checkbox" id="filter-fw-shops" checked>
              <span class="filter-checkbox"></span>
              <span class="filter-emoji">ğŸª</span> Tackle Shops
            </label>
          </div>
          <button class="filter-apply-btn" onclick="applyFreshwaterFilters()">âœ“ Apply Filters</button>
        </div>

        <!-- Freshwater Filter Overlay -->
        <div class="filter-overlay" id="freshwater-filter-overlay" onclick="closeFreshwaterFilterPanel()"></div>

        <div id="map"></div>
      </section>
    </div>
  </main>

  <!-- Community Page (Social) -->
  <main class="page" id="page-community" style="display: none;">
    <div class="app-container">
      <aside class="sidebar">
        <div class="card">
          <div class="card-header" style="justify-content: space-between; display: flex; align-items: center;">
            <span class="card-title">ğŸ“¸ Community Catches</span>
            <button class="btn btn-sm btn-primary" onclick="openPostModal(null)">ğŸ“ Post Update</button>
          </div>
          <div class="catch-feed" id="catch-feed">
            <div class="empty-state">
              <p>No catches shared yet. Be the first!</p>
            </div>
          </div>
        </div>
        <div class="sidebar-footer">
          <a href="https://www.buymeacoffee.com/AppDev21" target="_blank" class="btn btn-warning btn-sm"
            style="margin-bottom: 10px; width: 100%; display: flex; justify-content: center; align-items: center; gap: 8px;">
            <span style="font-size: 1.2rem;">ğŸ£</span> Support the Project
          </a>
          <div class="footer-links-row">
            <a href="#" onclick="openTermsModal()">Terms</a>
            <span class="divider">â€¢</span>
            <span>&copy; 2026 Irish Tides</span>
          </div>
        </div>
      </aside>
      <section class="map-container">
        <div id="community-gating-overlay" class="premium-overlay" style="display: none;">
          <div class="overlay-content">
            <div class="premium-badge">ğŸ† PREMIUM</div>
            <h2>Join the Crew!</h2>
            <p>The Community Hub is exclusive to Pro members. See live catches, share your own spots, and interact with
              other anglers across Ireland.</p>
            <div class="premium-price">Only â‚¬10 / month</div>
            <button class="btn btn-primary btn-lg" onclick="openPremiumModal()">Upgrade to Pro</button>
            <p class="premium-footer">Join 500+ pros on the water today ğŸ£</p>
          </div>
        </div>
        <div id="social-map"></div>
        <div class="map-overlay">
          <p>Click anywhere on the map to mark a new fishing spot!</p>
        </div>
      </section>
    </div>
  </main>

  <!-- Directory Page (National Shop List) -->
  <main class="page" id="page-directory" style="display: none;">
    <div class="directory-container">
      <div class="directory-hero">
        <h1>ğŸ‡®ğŸ‡ª National Tackle Store Directory</h1>
        <p>Find the best fishing gear across every county in Ireland</p>
      </div>
      <div class="county-directory" id="county-directory">
        <div class="loading">
          <div class="loading-spinner"></div>
          <span>Loading national directory...</span>
        </div>
      </div>
    </div>
  </main>

  <!-- Custom Catch Modal -->
  <div id="catch-modal" class="modal">
    <div class="modal-content">
      <h3>ğŸ£ Share Your Catch</h3>
      <div class="form-group">
        <label>What did you catch?</label>
        <input type="text" id="catch-species" placeholder="e.g., Sea Bass, Mackerel">
      </div>
      <div class="form-group">
        <label>Details</label>
        <textarea id="catch-details" placeholder="How was the fight? What bait did you use?"></textarea>
      </div>
      <div class="form-group">
        <label>Add a Photo</label>
        <div class="file-input-wrapper">
          <input type="file" id="catch-photo" accept="image/*" onchange="previewImage(this)">
          <div id="image-preview" class="image-preview" style="display: none;">
            <img id="preview-img" src="" alt="Preview">
            <button class="remove-image" onclick="removeImage()">âœ•</button>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="btn" onclick="closeModal()">Cancel</button>
        <button class="btn btn-primary" onclick="submitCatch()">Post Spot</button>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="auth-modal">
    <div class="modal-content">
      <h2 id="auth-title">Welcome Back</h2>
      <p id="auth-sub">Log in to your account</p>
      <div class="auth-form-container">
        <input type="email" id="auth-email" placeholder="Email Address" class="auth-input">
        <input type="text" id="auth-username" placeholder="Username (Signup Only)" class="auth-input"
          style="display: none;">
        <input type="password" id="auth-password" placeholder="Password" class="auth-input">
        <label class="auth-remember"
          style="display:flex; align-items:center; gap:8px; margin: 10px 0; font-size: 0.9rem; cursor: pointer;">
          <input type="checkbox" id="auth-remember" checked>
          <span>Remember me</span>
        </label>
        <button class="btn btn-primary" onclick="handleAuthSubmit()">Continue</button>
        <p class="auth-switch">Don't have an account? <a href="#" onclick="toggleAuthMode()">Sign up</a></p>
      </div>
      <button class="modal-close-btn" onclick="closeAuthModal()">âœ•</button>
    </div>
  </div>

  <!-- Premium Upgrade Modal -->
  <div class="modal" id="premium-modal">
    <div class="modal-content modal-large">
      <div class="premium-modal-grid">
        <div class="premium-modal-info">
          <div class="premium-badge">ğŸ† PRO PLAN</div>
          <h2>Unlock the Hub</h2>
          <ul class="premium-benefits">
            <li>âœ… Post catches to the Community Feed</li>
            <li>âœ… Detailed catch coordinates & spots</li>
            <li>âœ… Like & Comment on others posts</li>
            <li>âœ… Exclusive pro angler insights</li>
            <li>âœ… Support the development of Irish Tides</li>
          </ul>
        </div>
        <div class="premium-modal-cta">
          <div class="price-bubble">
            <span class="currency">â‚¬</span><span class="amount">10</span><span class="freq">/mo</span>
          </div>
          <p>Cancel any time. No contracts.</p>
          <button class="btn btn-success btn-lg" onclick="openStripeCheckout()">Start Pro Membership</button>
          <div class="stripe-badge-container">
            <svg class="stripe-svg" viewBox="0 0 60 25" xmlns="http://www.w3.org/2000/svg">
              <path fill="currentColor"
                d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.27 2.55 1.63 0 2.91-.44 3.82-1l.73 2.15c-1.12.77-2.85 1.34-4.88 1.34-3.51 0-5.73-2.22-5.73-6.24 0-3.66 2.04-6.3 5.42-6.3 3.32 0 5.14 2.51 5.14 5.74 0 .42-.03.82-.07 1.05.01-.15.01-.15.36-.29zm-7.98-2.15h5.1c-.13-1.63-1.42-2.3-2.52-2.3-1.39 0-2.34.84-2.58 2.3zM45.72 8.28c-1.36 0-2.23.63-2.73 1.25V8.5h-2.8v13.52c0 .28-.01.55.02.82l2.8-.2v-6.35c.57.57 1.41 1.01 2.52 1.01 2.36 0 4.38-2.11 4.38-5.51 0-3.48-2.01-5.51-4.19-5.51zm-.81 5.4c-1.07 0-1.74-.63-1.92-1.06v-2.09c.18-.43.85-1.06 1.92-1.06 1.15 0 1.65 1.08 1.65 2.11 0 1.02-.5 2.1-1.65 2.1zM34.78 6.55c-1.11 0-2.07.45-2.61.94V3.13l-3.04.64v13.52c0 .28-.01.55.02.82l2.8-.2V9.92c.51-.55 1.38-1.08 2.3-1.08.66 0 .97.31.97.99V18.1c0 .28-.01.55.02.82l2.8-.2v-9.5c.01-1.57-.96-2.67-3.26-2.67zM24.78 18.25l-.01.1L24.78 19.1c.21 0 .28-.01.28-.31V8.5h-2.8v1.3c-.53-.8-1.47-1.52-3.04-1.52-2.45 0-4.59 2.18-4.59 5.51 0 3.33 2.14 5.51 4.59 5.51 1.57 0 2.51-.72 3.04-1.52v.87c.01 0-.01.01-.1.1zM19.46 13.68c0-1.03.5-2.11 1.65-2.11 1.07 0 1.74.63 1.92 1.06v2.09c-.18.43-.85 1.06-1.92 1.06-1.15 0-1.65-1.08-1.65-2.11zM11.66 4.3c-.22 0-.46.03-.7.09l.48 2.6c.15-.04.31-.06.39-.06.74 0 1.19.43 1.19 1.19v.42H10.1v2.73h2.92v6.83c0 .28-.01.55.02.82l2.8-.2V11.27h1.99V8.54h-1.99V7.93c0-2.31-1.13-3.63-4.18-3.63zM1.02 11.27l1.37.58c1.39.59 2.05 1 2.05 1.98 0 .86-.71 1.33-1.89 1.33-1.51 0-3.13-.57-4.22-1.28L-2 16.51c1.36.85 3.35 1.51 5.37 1.51 3.55 0 5.4-1.74 5.4-4.29 0-3.37-2.32-4.11-4.73-5.11l-1.37-.58c-.97-.41-1.64-.78-1.64-1.51 0-.61.54-1.02 1.52-1.02 1.2 0 2.56.45 3.51.98l1.01-2.52C5.74 3.06 4.19 2.5 2.6 2.5.01 2.5-2.1 3.99-2.1 6.51c0 3.05 2.14 3.93 4.49 4.91z" />
            </svg>
            <span class="stripe-secure-text">Secure 256-bit SSL encrypted payment</span>
          </div>
        </div>
      </div>
      <button class="modal-close-btn" onclick="closePremiumModal()">âœ•</button>
    </div>
  </div>

  <!-- Stripe Checkout Modal -->
  <div class="modal" id="stripe-checkout-modal">
    <div class="modal-content stripe-checkout-container">
      <div class="stripe-header">
        <div class="stripe-logo">
          <svg viewBox="0 0 60 25" xmlns="http://www.w3.org/2000/svg">
            <path fill="currentColor"
              d="M59.64 14.28h-8.06c.19 1.93 1.6 2.55 3.27 2.55 1.63 0 2.91-.44 3.82-1l.73 2.15c-1.12.77-2.85 1.34-4.88 1.34-3.51 0-5.73-2.22-5.73-6.24 0-3.66 2.04-6.3 5.42-6.3 3.32 0 5.14 2.51 5.14 5.74 0 .42-.03.82-.07 1.05.01-.15.01-.15.36-.29zm-7.98-2.15h5.1c-.13-1.63-1.42-2.3-2.52-2.3-1.39 0-2.34.84-2.58 2.3zM45.72 8.28c-1.36 0-2.23.63-2.73 1.25V8.5h-2.8v13.52c0 .28-.01.55.02.82l2.8-.2v-6.35c.57.57 1.41 1.01 2.52 1.01 2.36 0 4.38-2.11 4.38-5.51 0-3.48-2.01-5.51-4.19-5.51zm-.81 5.4c-1.07 0-1.74-.63-1.92-1.06v-2.09c.18-.43.85-1.06 1.92-1.06 1.15 0 1.65 1.08 1.65 2.11 0 1.02-.5 2.1-1.65 2.1zM34.78 6.55c-1.11 0-2.07.45-2.61.94V3.13l-3.04.64v13.52c0 .28-.01.55.02.82l2.8-.2V9.92c.51-.55 1.38-1.08 2.3-1.08.66 0 .97.31.97.99V18.1c0 .28-.01.55.02.82l2.8-.2v-9.5c.01-1.57-.96-2.67-3.26-2.67zM24.78 18.25l-.01.1L24.78 19.1c.21 0 .28-.01.28-.31V8.5h-2.8v1.3c-.53-.8-1.47-1.52-3.04-1.52-2.45 0-4.59 2.18-4.59 5.51 0 3.33 2.14 5.51 4.59 5.51 1.57 0 2.51-.72 3.04-1.52v.87c.01 0-.01.01-.1.1zM19.46 13.68c0-1.03.5-2.11 1.65-2.11 1.07 0 1.74.63 1.92 1.06v2.09c-.18.43-.85 1.06-1.92 1.06-1.15 0-1.65-1.08-1.65-2.11zM11.66 4.3c-.22 0-.46.03-.7.09l.48 2.6c.15-.04.31-.06.39-.06.74 0 1.19.43 1.19 1.19v.42H10.1v2.73h2.92v6.83c0 .28-.01.55.02.82l2.8-.2V11.27h1.99V8.54h-1.99V7.93c0-2.31-1.13-3.63-4.18-3.63zM1.02 11.27l1.37.58c1.39.59 2.05 1 2.05 1.98 0 .86-.71 1.33-1.89 1.33-1.51 0-3.13-.57-4.22-1.28L-2 16.51c1.36.85 3.35 1.51 5.37 1.51 3.55 0 5.4-1.74 5.4-4.29 0-3.37-2.32-4.11-4.73-5.11l-1.37-.58c-.97-.41-1.64-.78-1.64-1.51 0-.61.54-1.02 1.52-1.02 1.2 0 2.56.45 3.51.98l1.01-2.52C5.74 3.06 4.19 2.5 2.6 2.5.01 2.5-2.1 3.99-2.1 6.51c0 3.05 2.14 3.93 4.49 4.91z" />
          </svg>
        </div>
        <button class="modal-close-btn-inline" onclick="closeStripeCheckout()">âœ•</button>
      </div>

      <div class="stripe-body">
        <div class="checkout-summary">
          <p class="product-name">Irish Fishing Hub Pro</p>
          <div class="product-price">â‚¬10.00 <span class="price-period">per month</span></div>
        </div>

        <div class="stripe-form">
          <div class="form-group stripe-field">
            <label>Card Information</label>
            <div class="card-input-container">
              <input type="text" id="stripe-card-number" placeholder="1234 5678 1234 5678" maxlength="19">
              <div class="card-meta">
                <input type="text" id="stripe-card-expiry" placeholder="MM / YY" maxlength="7">
                <input type="text" id="stripe-card-cvc" placeholder="CVC" maxlength="3">
              </div>
            </div>
          </div>

          <div class="form-group stripe-field">
            <label>Cardholder Name</label>
            <input type="text" id="stripe-card-name" placeholder="John Doe">
          </div>

          <div class="form-group stripe-field">
            <label>Country or region</label>
            <select id="stripe-country">
              <option value="IE">Ireland</option>
              <option value="UK">United Kingdom</option>
              <option value="US">United States</option>
            </select>
          </div>

          <button class="stripe-pay-btn" id="stripe-pay-btn" onclick="processStripePayment()">
            <span class="btn-text">Subscribe</span>
            <div class="stripe-spinner hidden" id="stripe-pay-spinner"></div>
          </button>

          <p class="stripe-disclaimer">By confirming your subscription, you allow Irish Fishing Hub to charge your card
            for this payment and future payments in accordance with their terms.</p>
        </div>
      </div>

      <div class="stripe-footer">
        <span class="powered-by">Powered by <strong>Stripe</strong></span>
        <div class="footer-links">
          <span>Terms</span>
          <span>Privacy</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Shop Details Modal -->
  <div class="modal" id="shop-details-modal">
    <div class="modal-content modal-large">
      <div id="shop-details-hero" class="street-view-container">
        <div class="loading-overlay" id="sv-loading">
          <div class="loading-spinner"></div>
        </div>
        <img id="street-view-image" src="" alt="Shop Exterior" style="display: none;"
          onload="this.style.display='block'; document.getElementById('sv-loading').style.display='none';">
        <div class="no-image-placeholder" id="sv-fallback" style="display: none;">
          <span>ğŸ™ï¸ No street view available</span>
        </div>
      </div>

      <div class="shop-details-body">
        <h2 id="shop-details-name">Shop Name</h2>
        <div class="shop-meta-large">
          <p id="shop-details-address"><span class="icon">ğŸ“</span> Loading address...</p>
          <p id="shop-details-phone"><span class="icon">ğŸ“</span> Loading phone...</p>
          <p id="shop-details-email"><span class="icon">ğŸ“§</span> Loading email...</p>
        </div>

        <div class="modal-actions">
          <button class="btn" onclick="closeShopDetails()">Close</button>
          <button id="shop-details-directions-btn" class="btn btn-primary">Get Directions</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Profile Modal -->
  <div class="modal" id="profile-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ‘¤ Your Profile</h2>
        <button class="modal-close-btn-inline" onclick="closeProfileModal()">âœ•</button>
      </div>

      <div class="profile-header-section">
        <div class="avatar-upload-wrapper">
          <img id="profile-avatar-preview" src="" alt="Profile">
          <label for="avatar-input" class="avatar-edit-btn">ğŸ“·</label>
          <input type="file" id="avatar-input" accept="image/*" style="display: none;"
            onchange="handleAvatarSelect(this)">
        </div>
        <div class="profile-status">
          <span id="profile-plan-badge" class="plan-badge">FREE PLAN</span>
          <button class="btn btn-sm btn-outline" id="profile-upgrade-btn" onclick="openPremiumModal()">Upgrade</button>
        </div>
      </div>

      <div class="form-group">
        <label>Display Name</label>
        <input type="text" id="profile-name" class="auth-input">
      </div>

      <div class="form-group">
        <label>Bio</label>
        <textarea id="profile-bio" class="auth-input" rows="3"
          placeholder="Tell us about your fishing experience..."></textarea>
      </div>

      <div class="modal-actions" style="justify-content: space-between; margin-top: 20px;">
        <button class="btn btn-danger btn-outline" onclick="logout()">Log Out</button>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-outline" onclick="openSupportModal()">ğŸ’¬ Contact Support</button>
          <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Dashboard Page -->
  <main class="page" id="page-admin" style="display: none;">
    <div class="admin-container">
      <div class="admin-header">
        <h1>ğŸ›¡ï¸ Admin Dashboard</h1>
        <p>Manage users, view insights, and respond to support messages</p>
      </div>

      <div class="admin-grid">
        <!-- Station Insights -->
        <div class="admin-card">
          <div class="admin-card-header">
            <h3>ğŸ“Š Tidal Station Insights</h3>
          </div>
          <div class="admin-card-body admin-card-body-flush" id="admin-station-insights">
            <div class="insight-grid">
              <div class="insight-item">
                <span class="insight-value" id="total-stations">0</span>
                <span class="insight-label">Total Stations</span>
              </div>
              <div class="insight-item">
                <span class="insight-value" id="active-stations">0</span>
                <span class="insight-label">Active</span>
              </div>
              <div class="insight-item">
                <span class="insight-value" id="offline-stations">0</span>
                <span class="insight-label">Offline</span>
              </div>
            </div>
            <div class="station-status-list" id="admin-station-list">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>

        <!-- User Accounts -->
        <div class="admin-card">
          <div class="admin-card-header" style="justify-content: space-between;">
            <div style="display: flex; align-items: center; gap: 15px;">
              <h3>ğŸ‘¥ User Accounts</h3>
              <input type="text" id="admin-user-search" placeholder="Search email/username..."
                class="admin-search-input" oninput="loadUsersTable()"
                style="padding: 4px 10px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color); font-size: 0.85rem; min-width: 200px;">
            </div>
            <span class="badge" id="total-users-badge">0 users</span>
          </div>
          <div class="admin-card-body admin-card-body-flush">
            <div class="admin-table-scroll-wrapper">
              <table class="admin-table" id="users-table">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Password</th>
                    <th>Plan</th>
                    <th>Joined</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                  <!-- Populated by JS -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Support Messages -->
        <div class="admin-card admin-card-full">
          <div class="admin-card-header">
            <h3>ğŸ’¬ Support Messages</h3>
            <span class="badge" id="unread-messages-badge">0 unread</span>
          </div>
          <div class="admin-card-body">
            <div class="messages-list" id="admin-messages-list">
              <div class="empty-state">
                <p>No support messages yet</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Location Manager -->
        <div class="admin-card admin-card-full">
          <div class="admin-card-header">
            <h3>ğŸ“ Location Manager</h3>
            <div class="admin-location-controls">
              <div class="mode-toggle-admin">
                <button class="mode-btn active" id="admin-mode-sea" onclick="setAdminMapMode('sea')">ğŸŒŠ Sea</button>
                <button class="mode-btn" id="admin-mode-freshwater" onclick="setAdminMapMode('freshwater')">ğŸï¸
                  Freshwater</button>
              </div>
              <select id="admin-location-type" class="admin-select">
                <option value="pier">ğŸ£ Pier</option>
                <option value="ramp">ğŸš¤ Boat Ramp</option>
                <option value="harbour">ğŸ›¥ï¸ Harbour</option>
                <option value="spot">ğŸŸ Fishing Spot</option>
                <option value="park">ğŸŒ² Park</option>
                <option value="shop">ğŸª Tackle Shop</option>
              </select>
              <button class="btn btn-primary btn-sm" id="add-location-btn" onclick="enableAddLocationMode()">
                â• Add Location
              </button>
            </div>
          </div>
          <div class="admin-card-body admin-map-body">
            <div class="admin-map-container">
              <div id="admin-map"></div>
              <div class="admin-map-instructions" id="admin-map-instructions" style="display: none;">
                Click on the map to place a new location
              </div>
            </div>
            <div class="admin-location-list">
              <h4>Locations <span id="admin-location-count">(0)</span></h4>
              <div class="location-list-items" id="admin-location-list">
                <!-- Populated by JS -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Location Editor Modal -->
  <div class="modal" id="location-editor-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="location-editor-title">Add Location</h2>
        <button class="modal-close-btn-inline" onclick="closeLocationEditor()">âœ•</button>
      </div>
      <form id="location-editor-form" onsubmit="saveLocation(event)">
        <input type="hidden" id="location-id">
        <input type="hidden" id="location-mode">
        <div class="form-group">
          <label for="location-name">Name *</label>
          <input type="text" id="location-name" required placeholder="Enter location name">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="location-lat">Latitude *</label>
            <input type="number" id="location-lat" required step="0.0001" placeholder="53.3478">
          </div>
          <div class="form-group">
            <label for="location-lon">Longitude *</label>
            <input type="number" id="location-lon" required step="0.0001" placeholder="-6.2044">
          </div>
        </div>
        <div class="form-group">
          <label for="location-type-edit">Type *</label>
          <select id="location-type-edit" required>
            <option value="pier">ğŸ£ Pier</option>
            <option value="ramp">ğŸš¤ Boat Ramp</option>
            <option value="harbour">ğŸ›¥ï¸ Harbour</option>
            <option value="spot">ğŸŸ Fishing Spot</option>
            <option value="park">ğŸŒ² Park</option>
            <option value="shop">ğŸª Tackle Shop</option>
          </select>
        </div>
        <div class="form-group">
          <label for="location-description">Description</label>
          <textarea id="location-description" rows="2" placeholder="Optional description"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-outline" onclick="closeLocationEditor()">Cancel</button>
          <button type="button" class="btn btn-danger" id="delete-location-btn" onclick="deleteLocation()"
            style="display: none;">Delete</button>
          <button type="submit" class="btn btn-primary">Save Location</button>
        </div>
      </form>
    </div>
  </div>


  <!-- Contact Support Modal -->
  <div class="modal" id="support-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ’¬ Contact Support</h2>
        <button class="modal-close-btn-inline" onclick="closeSupportModal()">âœ•</button>
      </div>

      <div class="support-thread" id="support-thread">
        <div class="empty-state">
          <p>No messages yet. Send us a message below!</p>
        </div>
      </div>

      <div class="support-compose">
        <textarea id="support-message-input" placeholder="Type your message here..." rows="3"></textarea>
        <button class="btn btn-primary" onclick="sendSupportMessage()">Send Message</button>
      </div>
    </div>
  </div>

  <!-- Public User Profile Modal -->
  <div class="modal" id="public-profile-modal">
    <div class="modal-content profile-modal-content">
      <div class="modal-header">
        <h2>ğŸ‘¤ User Profile</h2>
        <button class="modal-close-btn-inline" onclick="closePublicProfileModal()">âœ•</button>
      </div>
      <div class="public-profile-view">
        <div class="profile-avatar-large" id="public-profile-avatar">ğŸ‘¤</div>
        <h3 id="public-profile-name">User Name</h3>
        <span class="badge" id="public-profile-badge">Pro Angler</span>
        <p class="profile-bio" id="public-profile-bio">No bio available.</p>
        <div class="profile-stats-row">
          <div class="profile-stat">
            <span class="stat-value" id="public-profile-joined">-</span>
            <span class="stat-label">Joined</span>
          </div>
          <div class="profile-stat">
            <span class="stat-value" id="public-profile-catches">0</span>
            <span class="stat-label">Catches</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Reply Modal -->
  <div class="modal" id="admin-reply-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ“© Reply to <span id="reply-to-user">User</span></h2>
        <button class="modal-close-btn-inline" onclick="closeAdminReplyModal()">âœ•</button>
      </div>

      <div class="support-thread" id="admin-reply-thread">
        <!-- Shows conversation history -->
      </div>

      <div class="support-compose">
        <textarea id="admin-reply-input" placeholder="Type your reply..." rows="3"></textarea>
        <button class="btn btn-primary" onclick="sendAdminReply()">Send Reply</button>
      </div>
    </div>
  </div>

  <!-- Terms & Conditions Modal -->
  <div class="modal" id="terms-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>âš–ï¸ Terms & Conditions</h2>
        <button class="modal-close-btn-inline" onclick="closeTermsModal()">âœ•</button>
      </div>
      <div class="modal-body terms-content">
        <p>Last updated: January 23, 2026</p>

        <h3>1. Acceptance of Terms</h3>
        <p>By accessing the Irish Fishing Hub, you agree to be bound by these Terms and Conditions and all applicable
          laws and regulations in Ireland.</p>

        <h3>2. Use of Data</h3>
        <p>Tidal and weather data provided by this application is for informational and recreational fishing purposes
          only. Do not rely on this data for maritime navigation or safety-critical decisions. Always consult official
          Marine Institute (Ireland) notices and local harbor master reports.</p>

        <h3>3. Real-Time Data Accuracy</h3>
        <p>While we strive to provide real-time data from the Marine Institute sensor network, we cannot guarantee 100%
          uptime or accuracy. Data may be delayed or estimated during sensor maintenance or network outages.</p>

        <h3>4. Pro Subscription</h3>
        <p>Pro features are provided on a monthly subscription basis. Subscriptions can be cancelled at any time through
          the user profile menu.</p>

        <h3>5. Limitation of Liability</h3>
        <p>Irish Fishing Hub shall not be held liable for any loss, damage, or injury resulting from the use of data
          provided through this service.</p>

        <h3>6. Account Deactivation & Termination</h3>
        <p>Irish Fishing Hub reserves the right to deactivate or delete any user account at any time, for any reason, at
          our sole discretion, regardless of subscription status or payment history. This includes, but is not limited
          to, violations of community guidelines or suspicious activity.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closeTermsModal()">I Understand</button>
      </div>
    </div>
  </div>

  <!-- Privacy Policy Modal -->
  <div class="modal" id="privacy-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>ğŸ›¡ï¸ Privacy Policy</h2>
        <button class="modal-close-btn-inline" onclick="closePrivacyModal()">âœ•</button>
      </div>
      <div class="modal-body terms-content">
        <p>Last updated: January 23, 2026</p>

        <h3>1. Introduction</h3>
        <p>We value your privacy. This policy explains how Irish Fishing Hub collects and uses your data.</p>

        <h3>2. Data Collection</h3>
        <p><strong>Account Info:</strong> Email and username collected during signup (stored via Firebase).</p>
        <p><strong>Activity:</strong> Catch reports including photos, location, and fishing notes you choose to post.
        </p>
        <p><strong>Automated:</strong> Basic browsing data used by Google AdSense for advertisement delivery and
          security purposes.</p>

        <h3>3. Use of Data</h3>
        <p>We use your data to provide tide details, enable community posting features, manage your account, and display
          relevant advertisements via Google AdSense.</p>

        <h3>4. Data Sharing</h3>
        <p>We do not sell your personal data. Data is shared with our technology partners exclusively to operate the
          app: Firebase (Database), Stripe (Payments), and Google AdSense (Advertising).</p>

        <h3>5. Your Rights</h3>
        <p>You can request account deletion at any time via your Profile settings or by contacting us directly.</p>

        <h3>6. Cookies</h3>
        <p>We use essential cookies for keeping you logged in and for Google AdSense functionality.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" onclick="closePrivacyModal()">I Understand</button>
      </div>
    </div>
  </div>

  <!-- Mandatory Legal Consent Overlay -->
  <div class="legal-overlay hidden" id="legal-consent-overlay">
    <div class="legal-consent-card">
      <div class="legal-header">
        <div class="legal-logo">ğŸŒŠ</div>
        <h1>Legal Update</h1>
        <p>Please review and accept our updated terms to continue.</p>
      </div>

      <div class="legal-checklist">
        <label class="legal-item">
          <input type="checkbox" id="check-terms" onchange="updateLegalContinueButton()">
          <span class="custom-check"></span>
          <span class="legal-text">I accept the <a href="#" onclick="openTermsModal()">Terms & Conditions</a></span>
        </label>

        <label class="legal-item">
          <input type="checkbox" id="check-privacy" onchange="updateLegalContinueButton()">
          <span class="custom-check"></span>
          <span class="legal-text">I accept the <a href="#" onclick="openPrivacyModal()">Privacy Policy</a></span>
        </label>
      </div>

      <p class="legal-note">By clicking "Agree & Continue", you confirm you are over 18 or have parental consent to use
        this fishing hub.</p>

      <button id="legal-continue-btn" class="btn btn-primary btn-full" disabled onclick="acceptLegal()">
        Agree & Continue
      </button>
    </div>
  </div>

  <!-- Report Comment Modal -->
  <div class="modal" id="report-comment-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Report Comment</h2>
        <button class="modal-close" onclick="closeReportModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p class="report-comment-text" id="report-comment-text"></p>

        <div class="form-group">
          <label>Reason for reporting:</label>
          <select id="report-reason" class="form-input">
            <option value="spam">Spam</option>
            <option value="harassment">Harassment or Bullying</option>
            <option value="inappropriate">Inappropriate Content</option>
            <option value="misinformation">Misinformation</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label>Additional details (optional):</label>
          <textarea id="report-details" class="form-input" rows="3" placeholder="Provide more context..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeReportModal()">Cancel</button>
        <button class="btn btn-primary" onclick="submitReport()">Submit Report</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <script src="app.js"></script>
</body>

</html>